drop table if exists students;
drop table if exists specialty;
drop table if exists admission;
drop table if exists groups;
drop table if exists subjects;
drop table if exists subject_specialty;
drop table if exists session_results;

create table students(
id integer primary key, 
surname text not null, 
name text not null, 
patronymic text, 
birthday data not null, 
gender text not null
);

insert into students(id, surname, name, patronymic, birthday, gender) values
(1, "Акишев", "Даниил", "Витальевич", "2002-12-26", "male"),
(2, "Вельмискин", "Николай", "Михайлович", "2002-06-29", "male"),
(3, "Видяйкин", "Илья", "Александрович", "2003-05-17", "male"),
(4, "Гладышева", "Дарья", "Николаевна", "2002-12-10", "female"),
(5, "Гуськова", "Ирина", "Михайловна", "2002-02-19", "female"),
(6, "Дудоров", "Данила", "Викторович", "2002-12-31", "male"),
(7, "Заварюхина", "Юлия", "Викторовна", "2002-09-29", "female"),
(8, "Иншакова", "Анастасия", "Сергеевна", "2002-02-14", "female"),
(9, "Кулагин", "Павел", "Альбертович", "2001-03-16", "male"),
(10, "Максимов", "Степан", "Олегович", "2001-03-17", "male"),
(11, "Никулов", "Илья", "Алексеевич", "2001-06-01", "male"),
(12, "Осипов", "Даниил", "Александрович", "2001-01-03", "male"),
(13, "Паршин", "Дмитрий", "Иванович", "2000-03-10", "male"),
(14, "Потапкина", "Юлия", "Юрьевна", "2000-01-24", "female"),
(15, "Родькина", "Дарья", "Александровна", "2000-05-23", "female"),
(16, "Рузаева", "Алина", "Семеновна", "2000-11-10", "female"),
(17, "Светильников", "Данил", "Борисович", "1999-02-07", "male"),
(18, "Тайнов", "Александр", "Александрович", "1999-09-26", "male"),
(19, "Уткин", "Никита", "Витальевич", "1999-05-22", "male"),
(20, "Шабанов", "Данила", "Олегович", "1999-07-12", "male");

create table specialty(
id integer primary key,
title text not null
);

insert into specialty(id, title) values 
(1, "Математика и компьютерные науки"),
(2, "Фундаментальная информатика"),
(3, "Прикладная математика и информатика"),
(4, "Програмная инженирия");

create table admission(
id integer primary key,
student_id integer not null,
specialty_id integer not null,
date date not null,
foreign key (student_id) references students(id) on delete cascade,
foreign key (specialty_id) references specialty(id) on delete cascade
);

insert into admission(id, student_id, specialty_id, date) values
(1, 1, 1, '2021-09-01'),
(2, 2, 2, '2021-09-01'),
(3, 3, 3, '2021-09-01'),
(4, 4, 4, '2021-09-01'),
(5, 5, 1, '2020-09-01'),
(6, 6, 2, '2020-09-01'),
(7, 7, 3, '2020-09-01'),
(8, 8, 4, '2020-09-01'),
(9, 9, 1, '2019-09-01'),
(10, 10, 2, '2019-09-01'),
(11, 11, 3, '2019-09-01'),
(12, 12, 4, '2019-09-01'),
(13, 13, 1, '2018-09-01'),
(14, 14, 2, '2018-09-01'),
(15, 15, 3, '2018-09-01'),
(16, 16, 4, '2018-09-01'),
(17, 17, 1, '2017-09-01'),
(18, 18, 2, '2017-09-01'),
(19, 19, 3, '2017-09-01'),
(20, 20, 4, '2017-09-01');

create table groups(
id integer primary key,
student_id integer not null,
specialty_id integer not null,
group_on_course integer not null,
semester integer not null check(semester = 1 or semester = 2),
foreign key (student_id) references admission(student_id) on delete cascade,
foreign key (specialty_id) references admission(specialty_id) on delete cascade	
);

insert into groups(student_id, specialty_id, group_on_course, semester) 
select student_id, specialty_id , case when cast(cast(cast(round((julianday('now') - julianday(date))/360 + 1) as integer)as text) ||'0'|| cast(specialty_id as text) as integer) > 404 then cast('40'|| cast(specialty_id as text) as integer) else cast(cast(cast(round((julianday('now') - julianday(date))/360 + 1) as integer)as text) ||'0'|| cast(specialty_id as text) as integer) end, case when cast(strftime('%m', date('now')) as integer) >= 9 and cast(strftime('%m', date('now'))as integer) <= 12 then 1 else 2 end from admission;

create table subjects(
id integer primary key,
subject text not null,
type_certificat text not null check(type_certificat = 'зачет' or type_certificat = 'экзамен'),
hours_study integer not null,
course integer not null,
semester integer not null check(semester = 1 or semester = 2) 
);

insert into subjects(id, subject, type_certificat, hours_study, course, semester) values
(1, 'История', 'экзамен', 144, 1, 1),
(2, 'Аналитическая геометрия', 'экзамен', 144, 1, 1),
(3, 'Математический анализ-I', 'зачет', 180, 1, 1),
(4, 'Алгебра и геометрия', 'зачет', 180, 1, 1),
(5, 'Алгебра и геометрия', 'экзамен', 180, 1, 2),
(6, 'Основы программирования', 'экзамен', 144, 1, 2),
(7, 'Математический анализ-II', 'зачет', 180, 1, 2),
(8, 'Нечеткие множества', 'зачет', 72, 1, 2),
(9, 'Дискретная математика', 'экзамен', 144, 2, 1),
(10, 'Языки программирования', 'экзамен', 144, 2, 1),
(11, 'Дифференциальные уравнения', 'зачет', 144, 2, 1),
(12, 'Кратные интегралы и ряды', 'зачет', 180, 2, 1),
(13, 'Дифференциальные уравнения', 'экзамен', 144, 2, 2),
(14, 'Комплексный анализ', 'экзамен', 180, 2, 2),
(15, 'Теория автоматов и формальных языков', 'зачет', 108, 2, 2),
(16, 'Компьютерные сети', 'зачет', 108, 2, 2),
(17, 'Математическая логика и теория алгоритмов', 'экзамен', 180, 3, 1),
(18, 'Функциональный анализ', 'экзамен', 180, 3, 1),
(19, 'Физика', 'зачет', 108, 3, 1),
(20, 'Языковые средства поддержки сценариев Windows', 'зачет', 108, 3, 1),
(21, 'Методы оптимизации и исследование операций', 'экзамен', 108, 3, 2),
(22, 'Технологии баз данных', 'экзамен', 108, 3, 2),
(23, 'Операционные системы', 'зачет', 72, 3, 2),
(24, 'Сетевые языки и веб-программирование', 'зачет', 72, 3, 2),
(25, 'Вычислительные методы', 'экзамен', 108, 4, 1),
(26, 'Теория кодирования', 'экзамен', 108, 4, 1),
(27, 'Интеллектуальные системы', 'зачет', 72, 4, 1),
(28, 'Прикладные аспекты случайных процессов', 'зачет', 108, 4, 1),
(29, 'Объектно-ориентированное программирование на языках высокого уровня', 'экзамен', 108, 4, 2),
(30, 'Современные вычислительные методы прикладной математики', 'экзамен', 108, 4, 2),
(31, 'Программирование для процессоров различных архитектур', 'зачет', 108, 4, 1),
(32, 'Программное обеспечение математических моделей', 'зачет', 72, 4, 2);

create table subject_specialty (
id integer primary key,
specialty_id integer not null,
subject_id integer not null,
foreign key (subject_id) references subjects(id) on delete cascade,
foreign key (specialty_id) references specialty(id) on delete cascade
);

insert into subject_specialty(id, specialty_id, subject_id) values
(1, 1, 1),
(2, 1, 3),
(3, 1, 5),
(4, 1, 7),
(5, 1, 9),
(6, 1, 11),
(7, 1, 13),
(8, 1, 15),
(9, 1, 17),
(10, 1, 19),
(11, 1, 21),
(12, 1, 23),
(13, 1, 25),
(14, 1, 27),
(15, 1, 29),
(16, 1, 31),
(17, 2, 2),
(18, 2, 4),
(19, 2, 6),
(20, 2, 8),
(21, 2, 10),
(22, 2, 12),
(23, 2, 14),
(24, 2, 16),
(25, 2, 18),
(26, 2, 20),
(27, 2, 22),
(28, 2, 24),
(29, 2, 26),
(30, 2, 28),
(31, 2, 30),
(32, 2, 32),
(33, 3, 1),
(34, 3, 4),
(35, 3, 5),
(36, 3, 8),
(37, 3, 9),
(38, 3, 12),
(39, 3, 13),
(40, 3, 16),
(41, 3, 17),
(42, 3, 20),
(43, 3, 21),
(44, 3, 24),
(45, 3, 25),
(46, 3, 28),
(47, 3, 29),
(48, 3, 32),
(49, 4, 2),
(50, 4, 3),
(51, 4, 6),
(52, 4, 7),
(53, 4, 10),
(54, 4, 11),
(55, 4, 14),
(56, 4, 15),
(57, 4, 18),
(58, 4, 19),
(59, 4, 22),
(60, 4, 23),
(61, 4, 26),
(62, 4, 27),
(63, 4, 30),
(64, 4, 31);

create table session_results(
id integer primary key,
student_id integer not null,
subject_id integer not null,
point integer check(point <= 100 and point >= 0),
foreign key (student_id) references students(id) on delete cascade,
foreign key (subject_id) references subjects(id) on delete cascade
);

insert into session_results(id, student_id, subject_id, point) values
(1, 5, 1, 54),
(2, 5, 3, 55),
(3, 5, 5, 84),
(4, 5, 7, 65),
(5, 6, 2, 81),
(6, 6, 4, 76),
(7, 6, 6, 71),
(8, 6, 8, 97),
(9, 7, 1, 90),
(10, 7, 4, 53),
(11, 7, 5, 99),
(12, 7, 8, 89),
(13, 8, 2, 99),
(14, 8, 3, 99),
(15, 8, 6, 71),
(16, 8, 7, 95),
(17, 9, 1, 74),
(18, 9, 3, 54),
(19, 9, 5, 90),
(20, 9, 7, 76),
(21, 9, 9, 92),
(22, 9, 11, 55),
(23, 9, 13, 99),
(24, 9, 15, 68),
(25, 10, 2, 95),
(26, 10, 4, 71),
(27, 10, 6, 92),
(28, 10, 8, 77),
(29, 10, 10, 91),
(30, 10, 12, 71),
(31, 10, 14, 91),
(32, 10, 16, 91),
(33, 11, 1, 61),
(34, 11, 4, 83),
(35, 11, 5, 69),
(36, 11, 8, 83),
(37, 11, 9, 98),
(38, 11, 12, 95),
(39, 11, 13, 51),
(40, 11, 16, 61),
(41, 12, 2, 85),
(42, 12, 3, 72),
(43, 12, 6, 69),
(44, 12, 7, 86),
(45, 12, 10, 85),
(46, 12, 11, 84),
(47, 12, 14, 80),
(48, 12, 15, 65),
(49, 13, 1, 88),
(50, 13, 3, 67),
(51, 13, 5, 57),
(52, 13, 7, 68),
(53, 13, 9, 55),
(54, 13, 11, 73),
(55, 13, 13, 65),
(56, 13, 15, 84),
(57, 13, 17, 99),
(58, 13, 19, 92),
(59, 13, 21, 57),
(60, 13, 23, 79),
(61, 14, 2, 60),
(62, 14, 4, 79),
(63, 14, 6, 64),
(64, 14, 8, 70),
(65, 14, 10, 90),
(66, 14, 12, 53),
(67, 14, 14, 66),
(68, 14, 16, 62),
(69, 14, 18, 82),
(70, 14, 20, 97),
(71, 14, 22, 69),
(72, 14, 24, 61),
(73, 15, 1, 51),
(74, 15, 4, 69),
(75, 15, 5, 90),
(76, 15, 8, 92),
(77, 15, 9, 76),
(78, 15, 12, 70),
(79, 15, 13, 65),
(80, 15, 16, 71),
(81, 15, 17, 93),
(82, 15, 20, 72),
(83, 15, 21, 58),
(84, 15, 24, 61),
(85, 16, 2, 92),
(86, 16, 3, 69),
(87, 16, 6, 88),
(88, 16, 7, 52),
(89, 16, 10, 82),
(90, 16, 11, 97),
(91, 16, 14, 73),
(92, 16, 15, 70),
(93, 16, 18, 56),
(94, 16, 19, 66),
(95, 16, 22, 86),
(96, 16, 23, 100),
(97, 17, 1, 73),
(98, 17, 3, 73),
(99, 17, 5, 60),
(100, 17, 7, 63),
(101, 17, 9, 74),
(102, 17, 11, 86),
(103, 17, 13, 66),
(104, 17, 15, 72),
(105, 17, 17, 90),
(106, 17, 19, 57),
(107, 17, 21, 76),
(108, 17, 23, 72),
(109, 17, 25, 71),
(110, 17, 27, 78),
(111, 17, 29, 100),
(112, 17, 31, 78),
(113, 18, 2, 76),
(114, 18, 4, 93),
(115, 18, 6, 67),
(116, 18, 8, 82),
(117, 18, 10, 76),
(118, 18, 12, 94),
(119, 18, 14, 64),
(120, 18, 16, 52),
(121, 18, 18, 58),
(122, 18, 20, 59),
(123, 18, 22, 58),
(124, 18, 24, 74),
(125, 18, 26, 56),
(126, 18, 28, 56),
(127, 18, 30, 76),
(128, 18, 32, 59),
(129, 19, 1, 92),
(130, 19, 4, 90),
(131, 19, 5, 66),
(132, 19, 8, 93),
(133, 19, 9, 56),
(134, 19, 12, 77),
(135, 19, 13, 55),
(136, 19, 16, 70),
(137, 19, 17, 70),
(138, 19, 20, 53),
(139, 19, 21, 93),
(140, 19, 24, 70),
(141, 19, 25, 70),
(142, 19, 28, 53),
(143, 19, 29, 83),
(144, 19, 32, 92),
(145, 20, 2, 100),
(146, 20, 3, 56),
(147, 20, 6, 54),
(148, 20, 7, 67),
(149, 20, 10, 85),
(150, 20, 11, 78),
(151, 20, 14, 70),
(152, 20, 15, 63),
(153, 20, 18, 100),
(154, 20, 19, 78),
(155, 20, 22, 74),
(156, 20, 23, 56),
(157, 20, 26, 51),
(158, 20, 27, 85),
(159, 20, 30, 75),
(160, 20, 31, 71);
